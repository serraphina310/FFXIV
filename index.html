<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FF14 採集原料資料庫</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f4f9; padding-top: 20px; }
        .wiki-search-box { background: #e2e3e5; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
        .item-img { max-width: 50px; max-height: 50px; border-radius: 4px; }
        .loading { text-align: center; color: #666; font-style: italic; }
        h1 { color: #333; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <div class="text-center mb-4">
        <h1>FF14 採集原料資料庫</h1>
        <p class="text-muted">即時查詢採集地點與資訊</p>
    </div>

    <div class="wiki-search-box">
        <h5><i class="bi bi-search"></i> 搜尋 FF14 灰機 Wiki</h5>
        <div class="input-group">
            <input type="text" id="wikiInput" class="form-control" placeholder="輸入關鍵字 (例如: 鐵礦)...">
            <button class="btn btn-dark" onclick="searchWiki()">搜尋 Wiki</button>
        </div>
        <small class="text-muted">這將會開啟新分頁並透過 Google 搜尋 ff14.huijiwiki.com 站內資料</small>
    </div>

    <hr>

    <div class="mb-3">
        <label for="dbInput" class="form-label fw-bold">篩選本資料庫內容：</label>
        <input type="text" id="dbInput" class="form-control" placeholder="輸入原料名稱、地圖或備註關鍵字..." onkeyup="filterTable()">
    </div>

    <div class="table-responsive bg-white shadow-sm p-3 rounded">
        <div id="loadingMsg" class="loading">正在從 Google Sheets 讀取資料...</div>
        <table class="table table-hover align-middle d-none" id="dataTable">
            <thead class="table-primary">
                <tr>
                    <th>圖片</th>
                    <th>原料名稱</th>
                    <th>地圖編號</th>
                    <th>採集地點</th>
                    <th>備註</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                </tbody>
        </table>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

<script>
    // configuration
    // ==========================================
    // 請將下方的連結換成你第一步複製的 "發布到網路" CSV 連結
    const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSKLU1K1ol-mP7n2gz7clz522QmjoTAMRfz1lxSKjBwTPMvC5eMimPycZ-RsknpuYkUPaWmHWqj-QNe/pub?output=csv'; 
    // ==========================================

    // 1. 頁面載入時執行
    document.addEventListener('DOMContentLoaded', function() {
        loadData();
    });

    // 2. 讀取 Google Sheet 資料
    function loadData() {
        Papa.parse(SHEET_CSV_URL, {
            download: true,
            header: true, // 假設第一行是標題
            complete: function(results) {
                renderTable(results.data);
                document.getElementById('loadingMsg').style.display = 'none';
                document.getElementById('dataTable').classList.remove('d-none');
            },
            error: function(err) {
                document.getElementById('loadingMsg').innerText = "讀取失敗，請檢查 CSV 連結是否正確。";
                console.error("Error:", err);
            }
        });
    }

    // 3. 渲染表格
    function renderTable(data) {
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = ''; // 清空舊資料

        data.forEach(row => {
            // 排除空行
            if(!row['原料名稱']) return; 

            const tr = document.createElement('tr');
            
            // 處理圖片顯示，如果沒有連結則顯示預設文字
            const imgHtml = row['圖片連結'] 
                ? `<img src="${row['圖片連結']}" class="item-img" alt="${row['原料名稱']}">` 
                : '<span class="text-muted">-</span>';

            tr.innerHTML = `
                <td>${imgHtml}</td>
                <td class="fw-bold text-primary">${row['原料名稱']}</td>
                <td>${row['地圖編號'] || ''}</td>
                <td>${row['採集地點'] || ''}</td>
                <td><small>${row['備註'] || ''}</small></td>
            `;
            tbody.appendChild(tr);
        });
    }

    // 4. 資料庫內篩選功能
    function filterTable() {
        const input = document.getElementById('dbInput');
        const filter = input.value.toUpperCase();
        const table = document.getElementById('dataTable');
        const tr = table.getElementsByTagName('tr');

        // 從索引 1 開始迴圈 (跳過標題列)
        for (let i = 1; i < tr.length; i++) {
            const rowText = tr[i].textContent || tr[i].innerText;
            if (rowText.toUpperCase().indexOf(filter) > -1) {
                tr[i].style.display = "";
            } else {
                tr[i].style.display = "none";
            }
        }
    }

    // 5. 灰機 Wiki 搜尋功能
    function searchWiki() {
        const query = document.getElementById('wikiInput').value;
        if (query) {
            // 使用 Google 搜尋特定網站語法 site:ff14.huijiwiki.com
            const url = `https://www.google.com/search?q=site%3Aff14.huijiwiki.com+${encodeURIComponent(query)}`;
            window.open(url, '_blank');
        } else {
            alert("請輸入要搜尋的關鍵字");
        }
    }
    
    // 讓 Wiki 搜尋框支援按 Enter 鍵搜尋
    document.getElementById('wikiInput').addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            searchWiki();
        }
    });
</script>

</body>
</html>